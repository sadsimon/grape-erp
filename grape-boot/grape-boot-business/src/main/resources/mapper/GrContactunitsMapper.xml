<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.grape.product.mapper.GrContactunitsMapper">

    <select id="getList" resultType="net.grape.product.vo.ContactunitsListVO">
        SELECT
        t1.id,
        t1.contactunits_code,
        t1.contactunits_name,
        t1.category_id,
        y.category_name,
        t1.contact_id,
        t1.deposit_bank,
        t1.bank_number,
        t1.taxpayer_id_num,
        t1.initial_advance_payment,
        t1.rate,
        t1.initial_payable,
        t1.state,
        ct.contact_name,
        ct.mobile,
        ct.landline,
        ct.net_contact,
        ct.province,
        ct.city,
        ct.district,
        ct.address,
        ct.primary_person,
        t1.type
        FROM
        gr_contactunits t1
        LEFT JOIN gr_contactunits_contact ct ON ct.contactunits_id = t1.id
        AND ct.deleted = 0
        AND ct.primary_person = 0

        LEFT JOIN gr_contactunits_category y ON y.id = t1.category_id
        AND y.deleted = 0

        WHERE
        t1.deleted = 0

        <if test="param != null and param.trim() != ''">
            and (t1.contactunits_code like CONCAT('%', #{param}, '%')
            or t1.contactunits_name like CONCAT('%', #{param}, '%')
            or ct.contact_name like CONCAT('%', #{param}, '%')
            or ct.mobile like CONCAT('%', #{param}, '%')
            or ct.landline like CONCAT('%', #{param}, '%')
            )
        </if>

        <if test="categoryId != null">
            and y.id = #{categoryId}
        </if>
    </select>

</mapper>
